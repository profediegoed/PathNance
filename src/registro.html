<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro e Inicio de Sesión</title>
</head>
<body>
    <form id="registro">
        <h1>Registro</h1>
        <input type="text" id="nombre" placeholder="Ingrese el nombre">
        <input type="email" id="correo" placeholder="Ingrese el correo">
        <input type="password" id="contrasena" placeholder="Ingrese su contraseña">
        <button type="button" onclick="registrar()">Registrar</button>
        <p id="mensaje"></p>
    </form>
    
    <form id="login">
        <h1>Inicio de Sesión</h1>
        <input type="email" id="Logcorreo" placeholder="Ingrese el correo">
        <input type="password" id="Logcontrasena" placeholder="Ingrese su contraseña">
        <button type="button" onclick="validarLogin()">Login</button>
        <p id="Mensaje"></p>
    </form>
    
    <script>
        function registrar() {
            const nombre = document.getElementById('nombre').value;
            const correo = document.getElementById('correo').value;
            const contrasena = document.getElementById('contrasena').value;
    
            fetch('http://localhost:4000/registro', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombre, correo, contrasena })
            })
            .then(response => response.json())
            .then(data => {
                const mensajeElem = document.getElementById('mensaje');
                
                if (data.NombreR) {
                    mensajeElem.innerText = data.NombreR;
                } else if (data.EmailR) {
                    mensajeElem.innerText = data.EmailR;
                } else if (data.mensaje) {
                    mensajeElem.innerText = data.mensaje;
                    setTimeout(() => {
                      window.location.href = "../cuestionario/cuestio.html";
                    }, 1000);
                } else {
                    mensajeElem.innerText = 'Error desconocido';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('mensaje').innerText = 'Hubo un problema con el registro.';
            });
        }
    
        // Función para iniciar sesión
        function validarLogin() {
            const correo = document.getElementById('signInEmail').value;
            const contrasena = document.getElementById('signInPassword').value;
    
            fetch('http://localhost:4000/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ correo, contrasena })
            })
            .then(response => response.json())
            .then(data => {
                const mensajeElem = document.getElementById('Mensaje');
                
                if (data.correoInvalido) {
                    mensajeElem.innerText = data.correoInvalido;
                } else if (data.contrasenaInvalida) {
                    mensajeElem.innerText = data.contrasenaInvalida;
                } else if (data.token) {
                    // Guardar el token en localStorage
                    localStorage.setItem('authToken', data.token);
                    mensajeElem.innerText = 'Login exitoso';
                    setTimeout(() => {
                      window.location.href = "../PATH/paht.html";
                    }, 1000);
                } else {
                    mensajeElem.innerText = data.error || 'Error desconocido';
                }
                
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('Mensaje').innerText = 'Hubo un problema con el login.';
            });
        }
    
      </script>
</body>
</html>
